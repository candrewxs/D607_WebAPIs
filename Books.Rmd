---
title: "NYTimes Web APIs"
author: "Coffy Andrews-Guo"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Source: [GitHub]()      [RPubs]()


## Load packages
```{r, warning=FALSE, message=FALSE}
library("tidyverse")
library("httr")
library("reactable")
library("jsonlite")
library("tibble")
```


## Make a request to the API Server

In this assignment, The New York Times, JSON data was pulled using the Developer zone Book API on their Best Sellers list [https://developer.nytimes.com/apis](https://developer.nytimes.com/apis). A request for data with a GET function and returned a list containing all of the information from the API server.
```{r}
nybk <- GET("https://api.nytimes.com/svc/books/v3/lists/names.json?api-key=mRnATzHBDOaywjgsvH9402TBMw8RhxEG")
```

A summary provides a "Status" on the success or failure of the API request, and it comes in the form of a number. A desired number 200 corresponds to a successful request. The content type indicates what form the data takes and this response has  the data in a json format.
```{r}
nybk      # summary look at the resulting response
```

## Parsing Data

The NYTimes Book API Best Sellers content list is converted from a raw vector to a character. The `fromJSON` function combined with `rawToChar` function will parse the JSON file, convert the raw vector to a character, and create a data set. We will use `names` command to provide a list of the data set list elements.

```{r results='hide'}
rawToChar(nybk$content)  # convert raw vector to character vector objects
```

```{r}
nybook <- fromJSON(rawToChar(nybk$content))

names(nybook)   # returns list names
```

We will analyze the `results list` for it contains a nested hierarchical data structure with 59 observations and 6 variables. The `flatten()` function from `jsonlite` package assigned each of the variables as its own column. 
```{r}
nybks_flat <- flatten(nybook$results)

str(nybks_flat)
```

Converting the data frame to a table and show only the first 10 variables with data type.
```{r}
nybooks_tbl <- as.data.frame(nybks_flat) # convert data frame to a table data frame
names(nybooks_tbl) <- toupper(names(nybooks_tbl))  # convert the data frame names to uppercase

reactable(nybooks_tbl)
```


## Analysis

Load packages for analysis and visualization
```{r}
library("dplyr")
library("ggplot2")
library("stringr")
```

Extract sub strings in a character vector to analyze `best selling books against the newest published date`. 
```{r}
Year <- substr(nybooks_tbl$NEWEST_PUBLISHED_DATE, 1, 4 )
Month <- substr(nybooks_tbl$NEWEST_PUBLISHED_DATE, 6, 7)
Date <- substr(nybooks_tbl$NEWEST_PUBLISHED_DATE, nchar(nybooks_tbl$NEWEST_PUBLISHED_DATE) - 2 + 1, nchar(nybooks_tbl$NEWEST_PUBLISHED_DATE))
```

Combine the substrings into a data frame.  
```{r}
df <- cbind.data.frame(Year, Month, Date)

plot1 <- df %>% 
  group_by(Year) %>%
  summarise (Count = n()) %>%
  arrange(desc(Year))

plot1
```


```{r}
ggplot(df) +
  geom_bar(aes(Year, fill = Month)) +
 labs(x = "Published Year", y = "Count", 
     title = "NYTimes Best Selling Books by Newest Published Year and Month")
```

## Conclusion

In this assignment, NYTimes Developers API's, had a successful connection with `GET() function` to retrieve NYT Best Sellers Lists. A analysis was performed on `What year the Best Selling Books were published?`. The results showed a range between 2012 to 2021 and only three years (2014, 2018, and 2020) where a best selling book was not present. Although, these results are dynamic because the dataset is updated weekly.  
